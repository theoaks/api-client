/*! theoaksoft-api-client 2019-09-03 */

!function(e,t){"use strict";if("function"==typeof define&&define.amd)define(["lodash","fingerprintjs2"],t);else if("object"==typeof module&&"object"==typeof module.exports)module.exports=t(e,require("lodash"),require("fingerprintjs2"));else{if(void 0===e._)throw Error("ApiClient requires lodash");e.ApiClient=t(e,e._,e.fingerprintjs2),e.utils=e.ApiClient}}("undefined"!=typeof window?window:this,function(e,t,o){"use strict";var s={get:"GET",post:"POST",put:"PUT",delete:"DELETE"};function r(e){var t="There's a server connection currently active. If you close this window, you will lose the progress made";return e.returnValue=t,t}var n=function(){o.getV18(function(e){var t=new Date;t.setFullYear(t.getFullYear()+10),document.cookie="__deviceVerificationId="+e+";expires="+t.toUTCString()})};e.requestIdleCallback?e.requestIdleCallback(n):e.setTimeout(n,500);var a=function(e,t,o){this.apiUrlBase=e,this.authToken=t,this.publicKey=o,this.serverTimeout=null};return a.prototype={appId:null,deviceId:null,setServerTimeout(e){this.serverTimeout=NaN!==Number(e)?Number(e):null},sendForm:function(t,o,n,a){var i=this;return new Promise(function(a,u){var l=n.method||s.post,d=n;e.onbeforeunload=r,d instanceof FormData||(d=new FormData(n));n.enctype;"multipart/form-data"===n.enctype&&("multipart/form-data; charset=utf-8; boundary="+Math.random().toString().substr(2),l=s.post);var c=i.buildUrl(t,o);if(l.toUpperCase()===s.get){var p=[];for(var h in d.entries())p.push(encodeURIComponent(h[0])+"="+encodeURIComponent(h[1]));c=c+"?"+p.join("&")}var f=new XMLHttpRequest;f.onload=function(){var t=f.responseText;e.onbeforeunload=null;var o=JSON.parse(t);this.status>=200&&this.status<300?a(o):u(o)},f.onerror=function(){try{var e=JSON.parse(f.statusText)}catch(t){e={success:!1,message:f.statusText,data:null}}u(e)},f.open(l.toUpperCase(),c),null!=i.authToken&&f.setRequestHeader("Authorization",`Bearer ${i.authToken}`),f.setRequestHeader("Accept","application/json"),f.setRequestHeader("Oaks-Request-Source","xmlhttprequest"),f.setRequestHeader("Oaks-Origin-Host",location.protocol+"//"+location.host),f.setRequestHeader("Oaks-Origin-Url",location.href),f.withCredentials=!0,l.toLowerCase()===s.get.toLowerCase()?f.send():f.send(d)})},send(o,n,a){var i=this,u=this.buildUrl(o,n);e.onbeforeunload=r;var l=t.defaultsDeep(a,{method:"post",data:null});return new Promise((t,o)=>{var r=new XMLHttpRequest,n=l.data;if(r.onload=(()=>{var s=r.responseText;e.onbeforeunload=null;try{var n=JSON.parse(s);r.status>=200&&r.status<300?t(n):(n.statusCode=r.statusCode,o(n))}catch(e){o({success:!1,message:e,statusCode:r.statusCode})}}),r.onerror=(()=>{try{var e=JSON.parse(r.statusText)}catch(t){console.error(t),e={success:!1,message:r.statusText,data:null}}e.statusCode=r.statusCode,o(e)}),this.serverTimeout>0&&(r.ontimeout=(()=>{o({success:!1,message:"The server did not respond on time. You might need to try again later."})})),l.method.toLowerCase()===s.get.toLowerCase()){var a=[];for(var d in n)n.hasOwnProperty(d)&&a.push(encodeURIComponent(d)+"="+encodeURIComponent(n[d]));a.length>0&&(u=u+"?"+a.join("&"))}r.open(l.method.toUpperCase(),u),null!=this.authToken&&r.setRequestHeader("Authorization",`Bearer ${i.authToken}`),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Oaks-Request-Source","xmlhttprequest"),r.setRequestHeader("Oaks-Origin-Host",location.protocol+"//"+location.host),r.setRequestHeader("Oaks-Origin-Url",location.href),r.withCredentials=!0;try{"get"===l.method.toLowerCase()?r.send():(r.setRequestHeader("Content-Type","application/json"),r.send(JSON.stringify(n)))}catch(e){o({success:!1,message:"Unable to connect to the server."})}})},buildUrl(e,t){return this.apiUrlBase+"/"+e+"/"+t},isFunction:e=>"function"==typeof e,isObject:e=>"object"==typeof e},a});